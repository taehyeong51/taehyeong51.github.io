# **당신의 더욱 완벽한 추억을 위해**

Mask2Former(MMDetection) : https://github.com/open-mmlab/mmdetection.git

Lama : https://github.com/saic-mdal/lama

<img src = "https://drive.google.com/uc?id=1AsWI5RN66aQEprOnNQj_ryV27-YS8NNJ" height = 300 width = 1000>

이미지 내 불필요한 인물 객체를 제거하여 당신이 원하는 더욱 완벽한 사진을 생성할 수 있습니다.

[MMDetection](https://github.com/open-mmlab/mmdetection.git) 기반의 [Mask2Former](https://github.com/open-mmlab/mmdetection/tree/master/configs/mask2former)를 기반으로 인물을 탐지하여 mask를 생성하고 [LaMa](https://github.com/saic-mdal/lama) 를 기반으로 mask 영역의 이미지를 새롭게 생성하였습니다.





```python
#@title <b><font color="black">MMDetection 진행을 위한 환경 구축</b>
#@markdown 3-5분 정도 소요됩니다

import time
start = time.time()
!pip install rich
!pip install modelindex

!mi install mmcv-full

%cd /content
!pip3 install torch
!pip install torchvision
!pip3 install rich
!pip3 install modelindex
!pip3 install openmim
!mim install mmcv-full

!git clone https://github.com/open-mmlab/mmdetection.git

%cd /content/mmdetection

!pip install -r requirements/build.txt
!pip install -v -e .

# download pth(checkpoint) file of Mask2Former
!gdown https://download.openmmlab.com/mmdetection/v2.0/mask2former/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco_20220504_001756-743b7d99.pth
!mkdir /content/mmdetection/checkpoints
!mv /content/mmdetection/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco_20220504_001756-743b7d99.pth /content/mmdetection/checkpoints

!mkdir /content/input_lama
!mkdir /content/result
print("MMDetection 환경 구축 소요시간 : {}분".format(round((time.time() - start)/60,2)))
```

    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Collecting rich
      Downloading rich-12.5.1-py3-none-any.whl (235 kB)
    [K     |████████████████████████████████| 235 kB 5.2 MB/s 
    [?25hRequirement already satisfied: typing-extensions<5.0,>=4.0.0 in /usr/local/lib/python3.7/dist-packages (from rich) (4.1.1)
    Requirement already satisfied: pygments<3.0.0,>=2.6.0 in /usr/local/lib/python3.7/dist-packages (from rich) (2.6.1)
    Collecting commonmark<0.10.0,>=0.9.0
      Downloading commonmark-0.9.1-py2.py3-none-any.whl (51 kB)
    [K     |████████████████████████████████| 51 kB 3.9 MB/s 
    [?25hInstalling collected packages: commonmark, rich
    Successfully installed commonmark-0.9.1 rich-12.5.1
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Collecting modelindex
      Downloading modelindex-0.0.2-py3-none-any.whl (2.1 kB)
    Collecting model-index
      Downloading model_index-0.1.11-py3-none-any.whl (34 kB)
    Requirement already satisfied: markdown in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (3.4.1)
    Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (3.13)
    Collecting ordered-set
      Downloading ordered_set-4.1.0-py3-none-any.whl (7.6 kB)
    Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (7.1.2)
    Requirement already satisfied: importlib-metadata>=4.4 in /usr/local/lib/python3.7/dist-packages (from markdown->model-index->modelindex) (4.12.0)
    Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->modelindex) (3.8.1)
    Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->modelindex) (4.1.1)
    Installing collected packages: ordered-set, model-index, modelindex
    Successfully installed model-index-0.1.11 modelindex-0.0.2 ordered-set-4.1.0
    /bin/bash: mim: command not found
    /content
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Requirement already satisfied: torch in /usr/local/lib/python3.7/dist-packages (1.12.1+cu113)
    Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from torch) (4.1.1)
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Requirement already satisfied: torchvision in /usr/local/lib/python3.7/dist-packages (0.13.1+cu113)
    Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from torchvision) (4.1.1)
    Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from torchvision) (2.23.0)
    Requirement already satisfied: torch==1.12.1 in /usr/local/lib/python3.7/dist-packages (from torchvision) (1.12.1+cu113)
    Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in /usr/local/lib/python3.7/dist-packages (from torchvision) (7.1.2)
    Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from torchvision) (1.21.6)
    Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->torchvision) (2.10)
    Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->torchvision) (1.24.3)
    Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->torchvision) (2022.6.15)
    Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->torchvision) (3.0.4)
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Requirement already satisfied: rich in /usr/local/lib/python3.7/dist-packages (12.5.1)
    Requirement already satisfied: commonmark<0.10.0,>=0.9.0 in /usr/local/lib/python3.7/dist-packages (from rich) (0.9.1)
    Requirement already satisfied: typing-extensions<5.0,>=4.0.0 in /usr/local/lib/python3.7/dist-packages (from rich) (4.1.1)
    Requirement already satisfied: pygments<3.0.0,>=2.6.0 in /usr/local/lib/python3.7/dist-packages (from rich) (2.6.1)
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Requirement already satisfied: modelindex in /usr/local/lib/python3.7/dist-packages (0.0.2)
    Requirement already satisfied: model-index in /usr/local/lib/python3.7/dist-packages (from modelindex) (0.1.11)
    Requirement already satisfied: markdown in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (3.4.1)
    Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (7.1.2)
    Requirement already satisfied: ordered-set in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (4.1.0)
    Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from model-index->modelindex) (3.13)
    Requirement already satisfied: importlib-metadata>=4.4 in /usr/local/lib/python3.7/dist-packages (from markdown->model-index->modelindex) (4.12.0)
    Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->modelindex) (3.8.1)
    Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->modelindex) (4.1.1)
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Collecting openmim
      Downloading openmim-0.2.1-py2.py3-none-any.whl (49 kB)
    [K     |████████████████████████████████| 49 kB 3.2 MB/s 
    [?25hCollecting colorama
      Downloading colorama-0.4.5-py2.py3-none-any.whl (16 kB)
    Requirement already satisfied: pip>=19.3 in /usr/local/lib/python3.7/dist-packages (from openmim) (21.1.3)
    Requirement already satisfied: Click in /usr/local/lib/python3.7/dist-packages (from openmim) (7.1.2)
    Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from openmim) (1.3.5)
    Requirement already satisfied: rich in /usr/local/lib/python3.7/dist-packages (from openmim) (12.5.1)
    Requirement already satisfied: model-index in /usr/local/lib/python3.7/dist-packages (from openmim) (0.1.11)
    Requirement already satisfied: tabulate in /usr/local/lib/python3.7/dist-packages (from openmim) (0.8.10)
    Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from openmim) (2.23.0)
    Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from model-index->openmim) (3.13)
    Requirement already satisfied: ordered-set in /usr/local/lib/python3.7/dist-packages (from model-index->openmim) (4.1.0)
    Requirement already satisfied: markdown in /usr/local/lib/python3.7/dist-packages (from model-index->openmim) (3.4.1)
    Requirement already satisfied: importlib-metadata>=4.4 in /usr/local/lib/python3.7/dist-packages (from markdown->model-index->openmim) (4.12.0)
    Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->openmim) (3.8.1)
    Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata>=4.4->markdown->model-index->openmim) (4.1.1)
    Requirement already satisfied: numpy>=1.17.3 in /usr/local/lib/python3.7/dist-packages (from pandas->openmim) (1.21.6)
    Requirement already satisfied: pytz>=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas->openmim) (2022.1)
    Requirement already satisfied: python-dateutil>=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas->openmim) (2.8.2)
    Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil>=2.7.3->pandas->openmim) (1.15.0)
    Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->openmim) (3.0.4)
    Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->openmim) (2.10)
    Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->openmim) (2022.6.15)
    Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->openmim) (1.24.3)
    Requirement already satisfied: commonmark<0.10.0,>=0.9.0 in /usr/local/lib/python3.7/dist-packages (from rich->openmim) (0.9.1)
    Requirement already satisfied: pygments<3.0.0,>=2.6.0 in /usr/local/lib/python3.7/dist-packages (from rich->openmim) (2.6.1)
    Installing collected packages: colorama, openmim
    Successfully installed colorama-0.4.5 openmim-0.2.1
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Looking in links: https://download.openmmlab.com/mmcv/dist/cu113/torch1.12.0/index.html
    Collecting mmcv-full
      Downloading https://download.openmmlab.com/mmcv/dist/cu113/torch1.12.0/mmcv_full-1.6.1-cp37-cp37m-manylinux1_x86_64.whl (40.6 MB)
    [K     |████████████████████████████████| 40.6 MB 10.7 MB/s 
    [?25hCollecting yapf
      Downloading yapf-0.32.0-py2.py3-none-any.whl (190 kB)
    [K     |████████████████████████████████| 190 kB 5.1 MB/s 
    [?25hRequirement already satisfied: opencv-python>=3 in /usr/local/lib/python3.7/dist-packages (from mmcv-full) (4.6.0.66)
    Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from mmcv-full) (3.13)
    Requirement already satisfied: Pillow in /usr/local/lib/python3.7/dist-packages (from mmcv-full) (7.1.2)
    Collecting addict
      Downloading addict-2.4.0-py3-none-any.whl (3.8 kB)
    Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from mmcv-full) (1.21.6)
    Requirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from mmcv-full) (21.3)
    Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->mmcv-full) (3.0.9)
    Installing collected packages: yapf, addict, mmcv-full
    Successfully installed addict-2.4.0 mmcv-full-1.6.1 yapf-0.32.0
    Cloning into 'mmdetection'...
    remote: Enumerating objects: 29160, done.[K
    remote: Counting objects: 100% (41/41), done.[K
    remote: Compressing objects: 100% (40/40), done.[K
    remote: Total 29160 (delta 4), reused 9 (delta 1), pack-reused 29119[K
    Receiving objects: 100% (29160/29160), 39.60 MiB | 33.62 MiB/s, done.
    Resolving deltas: 100% (20845/20845), done.
    /content/mmdetection
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Requirement already satisfied: cython in /usr/local/lib/python3.7/dist-packages (from -r requirements/build.txt (line 2)) (0.29.32)
    Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from -r requirements/build.txt (line 3)) (1.21.6)
    Using pip 21.1.3 from /usr/local/lib/python3.7/dist-packages/pip (python 3.7)
    Value for scheme.platlib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/lib/python3.7/dist-packages
    sysconfig: /usr/lib/python3.7/site-packages
    Value for scheme.purelib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/lib/python3.7/dist-packages
    sysconfig: /usr/lib/python3.7/site-packages
    Value for scheme.headers does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/include/python3.7/UNKNOWN
    sysconfig: /usr/include/python3.7m/UNKNOWN
    Value for scheme.scripts does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/bin
    sysconfig: /usr/bin
    Value for scheme.data does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local
    sysconfig: /usr
    Additional context:
    user = False
    home = None
    root = None
    prefix = None
    Non-user install because site-packages writeable
    Created temporary directory: /tmp/pip-ephem-wheel-cache-x5pw5llu
    Created temporary directory: /tmp/pip-req-tracker-_ukxhhtl
    Initialized build tracking at /tmp/pip-req-tracker-_ukxhhtl
    Created build tracker: /tmp/pip-req-tracker-_ukxhhtl
    Entered build tracker: /tmp/pip-req-tracker-_ukxhhtl
    Created temporary directory: /tmp/pip-install-pebzd8x1
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Obtaining file:///content/mmdetection
      Added file:///content/mmdetection to build tracker '/tmp/pip-req-tracker-_ukxhhtl'
        Running setup.py (path:/content/mmdetection/setup.py) egg_info for package from file:///content/mmdetection
        Created temporary directory: /tmp/pip-pip-egg-info-duj2nv55
        Running command python setup.py egg_info
        running egg_info
        creating /tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info
        writing /tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/PKG-INFO
        writing dependency_links to /tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/dependency_links.txt
        writing requirements to /tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/requires.txt
        writing top-level names to /tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/top_level.txt
        writing manifest file '/tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/SOURCES.txt'
        reading manifest template 'MANIFEST.in'
        warning: no files found matching 'mmdet/VERSION'
        warning: no files found matching 'mmdet/.mim/model-index.yml'
        warning: no files found matching 'mmdet/.mim/demo/*/*'
        warning: no files found matching '*.py' under directory 'mmdet/.mim/configs'
        warning: no files found matching '*.yml' under directory 'mmdet/.mim/configs'
        warning: no files found matching '*.sh' under directory 'mmdet/.mim/tools'
        warning: no files found matching '*.py' under directory 'mmdet/.mim/tools'
        adding license file 'LICENSE'
        writing manifest file '/tmp/pip-pip-egg-info-duj2nv55/mmdet.egg-info/SOURCES.txt'
      Source in /content/mmdetection has version 2.25.1, which satisfies requirement mmdet==2.25.1 from file:///content/mmdetection
      Removed mmdet==2.25.1 from file:///content/mmdetection from build tracker '/tmp/pip-req-tracker-_ukxhhtl'
    Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from mmdet==2.25.1) (3.2.2)
    Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from mmdet==2.25.1) (1.21.6)
    Requirement already satisfied: pycocotools in /usr/local/lib/python3.7/dist-packages (from mmdet==2.25.1) (2.0.4)
    Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from mmdet==2.25.1) (1.15.0)
    2 location(s) to search for versions of terminaltables:
    * https://pypi.org/simple/terminaltables/
    * https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/
    Fetching project page and analyzing links: https://pypi.org/simple/terminaltables/
    Getting page https://pypi.org/simple/terminaltables/
    Found index url https://pypi.org/simple
    Looking up "https://pypi.org/simple/terminaltables/" in the cache
    Request header has "max_age" as 0, cache bypassed
    Starting new HTTPS connection (1): pypi.org:443
    https://pypi.org:443 "GET /simple/terminaltables/ HTTP/1.1" 200 2271
    Updating cache with response from "https://pypi.org/simple/terminaltables/"
    Caching due to etag
      Found link https://files.pythonhosted.org/packages/ec/82/6390ba7f110622d27b02451aaa294dc4b3133b7661e464db9a116e977324/terminaltables-1.0.0.tar.gz#sha256=4c909a5ee4a3d028b2c977d996f8b8cd9724ce8e4d9d834d65e78a98f7965b54 (from https://pypi.org/simple/terminaltables/), version: 1.0.0
      Found link https://files.pythonhosted.org/packages/97/65/858bc3ea6cc60edc959ce427a94227932b5d9a95b0bce82f16071419885c/terminaltables-1.0.1.tar.gz#sha256=5548ac567d38d6ac88a5e0fec2d95f646249f37e1ef8fd2d17f8fcaefc6cf592 (from https://pypi.org/simple/terminaltables/), version: 1.0.1
      Found link https://files.pythonhosted.org/packages/82/42/3f1140f6e538582fd514c765244662cca60885048cf610e7d00eaee8aeb1/terminaltables-1.0.2.tar.gz#sha256=cf97dd019af975cc64aa69aca435a43b0cffabb88df6f337c6b48de600c19f8e (from https://pypi.org/simple/terminaltables/), version: 1.0.2
      Found link https://files.pythonhosted.org/packages/80/07/5663569dfd8fa4e4fa3cb645b70f4972e3d79d056b71da12df174668c145/terminaltables-1.1.0.tar.gz#sha256=94a15e1a295265d130de67e9c2efef9e1cad1e64dd6ae0b80882076581605f8c (from https://pypi.org/simple/terminaltables/), version: 1.1.0
      Found link https://files.pythonhosted.org/packages/0c/4a/9b80642ac2463908fe77c9dbe138c56902fbf5a5a95d07203c131ec9ba90/terminaltables-1.1.1.tar.gz#sha256=b02c516d6d521ce0fe6e2a2753268e86547bbccab6bfa7e269a0f51766283fab (from https://pypi.org/simple/terminaltables/), version: 1.1.1
      Found link https://files.pythonhosted.org/packages/a8/65/f9c6bcfb1f81acdfcd1f8d633c6752cfdcc04b5fade7638a2a8dc7a720de/terminaltables-1.2.0.tar.gz#sha256=fff4aa62f296038d1526a91856f0b3de1e3bce31cfd1c5148cc3f795c1d396bf (from https://pypi.org/simple/terminaltables/), version: 1.2.0
      Found link https://files.pythonhosted.org/packages/3d/17/14aa6521b337be46c51dd7b31e7e617801e9f8db7f48583c767c02e0e72a/terminaltables-1.2.1.tar.gz#sha256=cf5f0fb6c6c3070d7af73537ded030858c122f253c87e7221f9a6da3782ce787 (from https://pypi.org/simple/terminaltables/), version: 1.2.1
      Found link https://files.pythonhosted.org/packages/d0/8e/9403573ff8aebc09ee0aacd57885050f74bd9f48a85c0735d33cacfa2469/terminaltables-2.0.0.tar.gz#sha256=2e0a6688071f2a881f8fa4455a362457dcd2317e374609f1a09baffa998e7492 (from https://pypi.org/simple/terminaltables/), version: 2.0.0
      Found link https://files.pythonhosted.org/packages/10/da/9bbb21c1c2f9be4df2056b00b569689b9ece538ef39bf8db34be25f9e850/terminaltables-2.1.0.tar.gz#sha256=33b60f027964214f4ff5821f43958d03add81784f7c183d86a7ee8f010350cf5 (from https://pypi.org/simple/terminaltables/), version: 2.1.0
      Found link https://files.pythonhosted.org/packages/58/c9/f0c174c4e828365df3593c66ac32474cd994a8ec36fe19a798261c96c3bc/terminaltables-3.0.0.tar.gz#sha256=bd2504031f09f942a8f221266adc61aee04a0368d5de0dacb7a53e508af6a518 (from https://pypi.org/simple/terminaltables/), version: 3.0.0
      Found link https://files.pythonhosted.org/packages/9b/c4/4a21174f32f8a7e1104798c445dacdc1d4df86f2f26722767034e4de4bff/terminaltables-3.1.0.tar.gz#sha256=f3eb0eb92e3833972ac36796293ca0906e998dc3be91fbe1f8615b331b853b81 (from https://pypi.org/simple/terminaltables/), version: 3.1.0
      Found link https://files.pythonhosted.org/packages/d7/9f/f0f648fd548373d641af6c820f0232c10aa46a64827a3828173d37cdef31/terminaltables-3.1.5-py2.py3-none-any.whl#sha256=fba86b91d3f4b212d48b50323f2979a8d6b366a59a7707200711bb59b0ee8d90 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.5
      Found link https://files.pythonhosted.org/packages/5a/16/dd906e12ee828fe64da455decb078bb25b06cf80f9f626ca21d278b867b6/terminaltables-3.1.6-py2.py3-none-any.whl#sha256=bb670016abe42d57c64a5dbae654ff07786b4dbab0a9bfb5858759bf03f06a4b (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.6
      Found link https://files.pythonhosted.org/packages/cf/55/c0f3ea1e5d20d3da27bfaa5902edfd7477793bb4d7bd846ecc28e2f8dd98/terminaltables-3.1.6.tar.gz#sha256=205ffea11d84956889851560874268693adaf08e02f942ad2fbbc08fcab18ebb (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.6
      Found link https://files.pythonhosted.org/packages/1e/d0/663ada6aea1ed17d9b9c22a896d1fbecfff24c4e0abe6e7e212443b12499/terminaltables-3.1.7-py2.py3-none-any.whl#sha256=18ba14fdfbc6a6d7dcf65aa0871a5dbea81d7d324ecfad8dc8c2f94b3efb4f2e (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.7
      Found link https://files.pythonhosted.org/packages/b0/6d/19ab8dd9b85b804e4d90fba678156bf4f3dcc04935edbfb5ff8ebcec5199/terminaltables-3.1.7.tar.gz#sha256=5dab2f33927c0a020b8011c81b92830ff9fd4ba701657da5d7bfdc41048360a6 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.7
      Found link https://files.pythonhosted.org/packages/6f/6b/ad2cbd9bb0341479a5f77f6b97a42792b2fdfc2d33ac07fbbacabaa3c5a3/terminaltables-3.1.8-py2.py3-none-any.whl#sha256=383916b5a203e6ac754ffbc18084a4988ef0746d7d754afd9f1188c3c003e399 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.8
      Found link https://files.pythonhosted.org/packages/95/a5/2b63645cc40dfcb7686725b9ed7c4b016df09eb2dbc7329f2d55742ad015/terminaltables-3.1.8.tar.gz#sha256=86ec4e5e439c17c0c097e3723346fda87b151bbb526afa2c5236016b27b70f3d (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.8
      Found link https://files.pythonhosted.org/packages/d3/49/799fcba07ca12a3b6cb141ac744755306a7d7b6e7d580f08388d2b64a00b/terminaltables-3.1.9-py2.py3-none-any.whl#sha256=b4b149ad5c0de74269573dc55f205b6196efe905565fac009724e506d42ea365 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.9
      Found link https://files.pythonhosted.org/packages/c9/f8/3437904b3e5b4f050f1dc254c0eee706df6ff25098cf5b759a33da94a506/terminaltables-3.1.9.tar.gz#sha256=df28eedd73431283c59c44ebdfaefa6c4905e3d1704a4c2eaf692046efcb6774 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.9
      Found link https://files.pythonhosted.org/packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl#sha256=e4fdc4179c9e4aab5f674d80f09d76fa436b96fdc698a8505e0a36bf0804a874 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.10
      Found link https://files.pythonhosted.org/packages/f5/fc/0b73d782f5ab7feba8d007573a3773c58255f223c5940a7b7085f02153c3/terminaltables-3.1.10.tar.gz#sha256=ba6eca5cb5ba02bba4c9f4f985af80c54ec3dccf94cfcd190154386255e47543 (from https://pypi.org/simple/terminaltables/) (requires-python:>=2.6), version: 3.1.10
    Fetching project page and analyzing links: https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/
    Getting page https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/
    Found index url https://us-python.pkg.dev/colab-wheels/public/simple/
    Looking up "https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/" in the cache
    Request header has "max_age" as 0, cache bypassed
    Starting new HTTPS connection (1): us-python.pkg.dev:443
    https://us-python.pkg.dev:443 "GET /colab-wheels/public/simple/terminaltables/ HTTP/1.1" 404 32
    Status code 404 not in (200, 203, 300, 301)
    Could not fetch URL https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/: 404 Client Error: Not Found for url: https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/ - skipping
    Skipping link: not a file: https://us-python.pkg.dev/colab-wheels/public/simple/terminaltables/
    Skipping link: not a file: https://pypi.org/simple/terminaltables/
    Given no hashes to check 22 links for project 'terminaltables': discarding no candidates
    Collecting terminaltables
      Created temporary directory: /tmp/pip-unpack-3lc_zj4t
      Looking up "https://files.pythonhosted.org/packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl" in the cache
      No cache entry available
      Starting new HTTPS connection (1): files.pythonhosted.org:443
      https://files.pythonhosted.org:443 "GET /packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl HTTP/1.1" 200 15155
      Downloading terminaltables-3.1.10-py2.py3-none-any.whl (15 kB)
      Ignoring unknown cache-control directive: immutable
      Updating cache with response from "https://files.pythonhosted.org/packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl"
      Caching due to etag
      Added terminaltables from https://files.pythonhosted.org/packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl#sha256=e4fdc4179c9e4aab5f674d80f09d76fa436b96fdc698a8505e0a36bf0804a874 (from mmdet==2.25.1) to build tracker '/tmp/pip-req-tracker-_ukxhhtl'
      Removed terminaltables from https://files.pythonhosted.org/packages/c4/fb/ea621e0a19733e01fe4005d46087d383693c0f4a8f824b47d8d4122c87e0/terminaltables-3.1.10-py2.py3-none-any.whl#sha256=e4fdc4179c9e4aab5f674d80f09d76fa436b96fdc698a8505e0a36bf0804a874 (from mmdet==2.25.1) from build tracker '/tmp/pip-req-tracker-_ukxhhtl'
    Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib->mmdet==2.25.1) (0.11.0)
    Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->mmdet==2.25.1) (2.8.2)
    Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->mmdet==2.25.1) (3.0.9)
    Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib->mmdet==2.25.1) (1.4.4)
    Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver>=1.0.1->matplotlib->mmdet==2.25.1) (4.1.1)
    Created temporary directory: /tmp/pip-unpack-79ebru79
    Installing collected packages: terminaltables, mmdet
      Value for scheme.platlib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/lib/python3.7/dist-packages
      sysconfig: /usr/lib/python3.7/site-packages
      Value for scheme.purelib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/lib/python3.7/dist-packages
      sysconfig: /usr/lib/python3.7/site-packages
      Value for scheme.headers does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/include/python3.7/terminaltables
      sysconfig: /usr/include/python3.7m/terminaltables
      Value for scheme.scripts does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/bin
      sysconfig: /usr/bin
      Value for scheme.data does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local
      sysconfig: /usr
      Additional context:
      user = False
      home = None
      root = None
      prefix = None
    
      Value for scheme.platlib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/lib/python3.7/dist-packages
      sysconfig: /usr/lib/python3.7/site-packages
      Value for scheme.purelib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/lib/python3.7/dist-packages
      sysconfig: /usr/lib/python3.7/site-packages
      Value for scheme.headers does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/include/python3.7/mmdet
      sysconfig: /usr/include/python3.7m/mmdet
      Value for scheme.scripts does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local/bin
      sysconfig: /usr/bin
      Value for scheme.data does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
      distutils: /usr/local
      sysconfig: /usr
      Additional context:
      user = False
      home = None
      root = None
      prefix = None
      Running setup.py develop for mmdet
        Running command /usr/bin/python3 -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/content/mmdetection/setup.py'"'"'; __file__='"'"'/content/mmdetection/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' develop --no-deps
        running develop
        running egg_info
        creating mmdet.egg-info
        writing mmdet.egg-info/PKG-INFO
        writing dependency_links to mmdet.egg-info/dependency_links.txt
        writing requirements to mmdet.egg-info/requires.txt
        writing top-level names to mmdet.egg-info/top_level.txt
        writing manifest file 'mmdet.egg-info/SOURCES.txt'
        reading manifest template 'MANIFEST.in'
        warning: no files found matching 'mmdet/VERSION'
        warning: no files found matching 'mmdet/.mim/demo/*/*'
        adding license file 'LICENSE'
        writing manifest file 'mmdet.egg-info/SOURCES.txt'
        running build_ext
        Creating /usr/local/lib/python3.7/dist-packages/mmdet.egg-link (link to .)
        Adding mmdet 2.25.1 to easy-install.pth file
    
        Installed /content/mmdetection
        /usr/local/lib/python3.7/dist-packages/torch/utils/cpp_extension.py:411: UserWarning: Attempted to use ninja as the BuildExtension backend but we could not find ninja.. Falling back to using the slow distutils backend.
          warnings.warn(msg.format('we could not find ninja.'))
    Value for scheme.platlib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/lib/python3.7/dist-packages
    sysconfig: /usr/lib/python3.7/site-packages
    Value for scheme.purelib does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/lib/python3.7/dist-packages
    sysconfig: /usr/lib/python3.7/site-packages
    Value for scheme.headers does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/include/python3.7/UNKNOWN
    sysconfig: /usr/include/python3.7m/UNKNOWN
    Value for scheme.scripts does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local/bin
    sysconfig: /usr/bin
    Value for scheme.data does not match. Please report this to <https://github.com/pypa/pip/issues/9617>
    distutils: /usr/local
    sysconfig: /usr
    Additional context:
    user = False
    home = None
    root = None
    prefix = None
    Successfully installed mmdet-2.25.1 terminaltables-3.1.10
    Removed build tracker: '/tmp/pip-req-tracker-_ukxhhtl'
    Downloading...
    From: https://download.openmmlab.com/mmdetection/v2.0/mask2former/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco_20220504_001756-743b7d99.pth
    To: /content/mmdetection/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco_20220504_001756-743b7d99.pth
    100% 276M/276M [00:28<00:00, 9.56MB/s]
    MMDetection 환경 구축 소요시간 : 1.37분
    


```python
#@title <b><font color="black">LaMa 환경 구축</b>
#@markdown 6-7분 정도 소요됩니다

import time
start = time.time()
%cd /content
# Run this sell to set everything up
print('\n> Cloning the repo')
!git clone https://github.com/saic-mdal/lama.git

print('\n> Install dependencies')
!pip install torch==1.8.0 torchvision==0.9.0 torchaudio==0.8.0 torchtext==0.9
!pip install -r lama/requirements.txt --quiet
!pip install wget --quiet
!pip install torch==1.8.0+cu111 torchvision==0.9.0+cu111 torchaudio==0.8.0 -f https://download.pytorch.org/whl/torch_stable.html --quiet


print('\n> Changing the dir to:')
%cd /content/lama
!export TORCH_HOME=$(pwd) && export PYTHONPATH=$(pwd)
# % export TORCH_HOME=$(pwd) && export PYTHONPATH=$(pwd)



print('\n> Download the model')
!curl -L $(yadisk-direct https://disk.yandex.ru/d/ouP6l8VJ0HpMZg) -o big-lama.zip
!unzip big-lama.zip

print('>fixing opencv')
!pip uninstall opencv-python-headless -y --quiet
!pip install opencv-python-headless==4.1.2.30 --quiet

%cd /content/lama
!export TORCH_HOME=$(pwd) && export PYTHONPATH=$(pwd)

print("LaMa 환경 구축 소요시간 : {}분".format(round((time.time() - start)/60,2)))
```

    /content
    
    > Cloning the repo
    Cloning into 'lama'...
    remote: Enumerating objects: 367, done.[K
    remote: Counting objects: 100% (35/35), done.[K
    remote: Compressing objects: 100% (25/25), done.[K
    remote: Total 367 (delta 16), reused 18 (delta 8), pack-reused 332[K
    Receiving objects: 100% (367/367), 9.88 MiB | 33.48 MiB/s, done.
    Resolving deltas: 100% (112/112), done.
    
    > Install dependencies
    Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
    Collecting torch==1.8.0
      Downloading torch-1.8.0-cp37-cp37m-manylinux1_x86_64.whl (735.5 MB)
    [K     |████████████████████████████████| 735.5 MB 15 kB/s 
    [?25hCollecting torchvision==0.9.0
      Downloading torchvision-0.9.0-cp37-cp37m-manylinux1_x86_64.whl (17.3 MB)
    [K     |████████████████████████████████| 17.3 MB 36.8 MB/s 
    [?25hCollecting torchaudio==0.8.0
      Downloading torchaudio-0.8.0-cp37-cp37m-manylinux1_x86_64.whl (1.9 MB)
    [K     |████████████████████████████████| 1.9 MB 52.8 MB/s 
    [?25hCollecting torchtext==0.9
      Downloading torchtext-0.9.0-cp37-cp37m-manylinux1_x86_64.whl (7.1 MB)
    [K     |████████████████████████████████| 7.1 MB 19.9 MB/s 
    [?25hRequirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from torch==1.8.0) (4.1.1)
    Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from torch==1.8.0) (1.21.6)
    Requirement already satisfied: pillow>=4.1.1 in /usr/local/lib/python3.7/dist-packages (from torchvision==0.9.0) (7.1.2)
    Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from torchtext==0.9) (4.64.0)
    Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from torchtext==0.9) (2.23.0)
    Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->torchtext==0.9) (2022.6.15)
    Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->torchtext==0.9) (3.0.4)
    Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->torchtext==0.9) (2.10)
    Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->torchtext==0.9) (1.24.3)
    Installing collected packages: torch, torchvision, torchtext, torchaudio
      Attempting uninstall: torch
        Found existing installation: torch 1.12.1+cu113
        Uninstalling torch-1.12.1+cu113:
          Successfully uninstalled torch-1.12.1+cu113
      Attempting uninstall: torchvision
        Found existing installation: torchvision 0.13.1+cu113
        Uninstalling torchvision-0.13.1+cu113:
          Successfully uninstalled torchvision-0.13.1+cu113
      Attempting uninstall: torchtext
        Found existing installation: torchtext 0.13.1
        Uninstalling torchtext-0.13.1:
          Successfully uninstalled torchtext-0.13.1
      Attempting uninstall: torchaudio
        Found existing installation: torchaudio 0.12.1+cu113
        Uninstalling torchaudio-0.12.1+cu113:
          Successfully uninstalled torchaudio-0.12.1+cu113
    Successfully installed torch-1.8.0 torchaudio-0.8.0 torchtext-0.9.0 torchvision-0.9.0
    [K     |████████████████████████████████| 12.5 MB 2.8 MB/s 
    [K     |████████████████████████████████| 22.3 MB 81 kB/s 
    [K     |████████████████████████████████| 72 kB 922 kB/s 
    [K     |████████████████████████████████| 144 kB 74.0 MB/s 
    [K     |████████████████████████████████| 841 kB 68.9 MB/s 
    [K     |████████████████████████████████| 271 kB 72.2 MB/s 
    [K     |████████████████████████████████| 46 kB 4.2 MB/s 
    [K     |████████████████████████████████| 74 kB 4.3 MB/s 
    [K     |████████████████████████████████| 112 kB 64.8 MB/s 
    [K     |████████████████████████████████| 176 kB 67.5 MB/s 
    [K     |████████████████████████████████| 141 kB 70.6 MB/s 
    [K     |████████████████████████████████| 596 kB 71.7 MB/s 
    [K     |████████████████████████████████| 829 kB 74.5 MB/s 
    [?25h  Building wheel for antlr4-python3-runtime (setup.py) ... [?25l[?25hdone
      Building wheel for future (setup.py) ... [?25l[?25hdone
    [31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
    yellowbrick 1.4 requires scikit-learn>=1.0.0, but you have scikit-learn 0.24.2 which is incompatible.[0m
      Building wheel for wget (setup.py) ... [?25l[?25hdone
    [K     |█████████████▌                  | 834.1 MB 57.8 MB/s eta 0:00:20tcmalloc: large alloc 1147494400 bytes == 0x64de4000 @  0x7f523a21c615 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x548ae9 0x51566f 0x549576 0x593fce 0x548ae9 0x5127f1 0x598e3b 0x511f68 0x598e3b 0x511f68 0x598e3b 0x511f68 0x4bc98a 0x532e76 0x594b72 0x515600 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x5118f8 0x593dd7
    [K     |█████████████████               | 1055.7 MB 1.3 MB/s eta 0:11:40tcmalloc: large alloc 1434370048 bytes == 0x260c000 @  0x7f523a21c615 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x548ae9 0x51566f 0x549576 0x593fce 0x548ae9 0x5127f1 0x598e3b 0x511f68 0x598e3b 0x511f68 0x598e3b 0x511f68 0x4bc98a 0x532e76 0x594b72 0x515600 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x5118f8 0x593dd7
    [K     |█████████████████████▋          | 1336.2 MB 1.5 MB/s eta 0:07:15tcmalloc: large alloc 1792966656 bytes == 0x57df8000 @  0x7f523a21c615 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x548ae9 0x51566f 0x549576 0x593fce 0x548ae9 0x5127f1 0x598e3b 0x511f68 0x598e3b 0x511f68 0x598e3b 0x511f68 0x4bc98a 0x532e76 0x594b72 0x515600 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x5118f8 0x593dd7
    [K     |███████████████████████████▎    | 1691.1 MB 1.3 MB/s eta 0:03:48tcmalloc: large alloc 2241208320 bytes == 0xc2be0000 @  0x7f523a21c615 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x548ae9 0x51566f 0x549576 0x593fce 0x548ae9 0x5127f1 0x598e3b 0x511f68 0x598e3b 0x511f68 0x598e3b 0x511f68 0x4bc98a 0x532e76 0x594b72 0x515600 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x5118f8 0x593dd7
    [K     |████████████████████████████████| 1982.2 MB 1.2 MB/s eta 0:00:01tcmalloc: large alloc 1982251008 bytes == 0x260c000 @  0x7f523a21b1e7 0x4a3940 0x4a39cc 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x593dd7 0x511e2c 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x548ae9
    tcmalloc: large alloc 2477817856 bytes == 0x148542000 @  0x7f523a21c615 0x592b76 0x4df71e 0x59afff 0x515655 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x549576 0x593fce 0x511e2c 0x593dd7 0x511e2c 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576 0x593fce 0x548ae9 0x5127f1 0x549576
    [K     |████████████████████████████████| 1982.2 MB 5.6 kB/s 
    [K     |████████████████████████████████| 17.6 MB 1.2 MB/s 
    [?25h
    > Changing the dir to:
    /content/lama
    
    > Download the model
      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed
      0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0
    100  363M    0  363M    0     0  9896k      0 --:--:--  0:00:37 --:--:--  9.9M
    Archive:  big-lama.zip
      inflating: big-lama/config.yaml    
      inflating: big-lama/models/best.ckpt  
    >fixing opencv
    [K     |████████████████████████████████| 21.8 MB 4.6 MB/s 
    [?25h/content/lama
    LaMa 환경 구축 소요시간 : 5.45분
    


```python
#@title <b><font color="black">segmentation 모델 설정 → Mask2Former</b>
% cd /content/mmdetection
from mmdet.apis import init_detector, inference_detector, show_result_pyplot
from google.colab.patches import cv2_imshow
import mmcv
import numpy as np
import cv2
import pandas as pd

config_file = 'configs/mask2former/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco.py'
checkpoint_file = 'checkpoints/mask2former_swin-s-p4-w7-224_lsj_8x2_50e_coco_20220504_001756-743b7d99.pth'

# build the model from a config file and a checkpoint file
model = init_detector(config_file, checkpoint_file, device='cuda:0')
```

    /content/mmdetection
    


    ---------------------------------------------------------------------------

    ImportError                               Traceback (most recent call last)

    <ipython-input-4-84ef52286ffc> in <module>()
          1 #@title <b><font color="black">segmentation 모델 설정 → Mask2Former</b>
          2 get_ipython().magic('cd /content/mmdetection')
    ----> 3 from mmdet.apis import init_detector, inference_detector, show_result_pyplot
          4 from google.colab.patches import cv2_imshow
          5 import mmcv
    

    /content/mmdetection/mmdet/apis/__init__.py in <module>()
          1 # Copyright (c) OpenMMLab. All rights reserved.
    ----> 2 from .inference import (async_inference_detector, inference_detector,
          3                         init_detector, show_result_pyplot)
          4 from .test import multi_gpu_test, single_gpu_test
          5 from .train import (get_root_logger, init_random_seed, set_random_seed,
    

    /content/mmdetection/mmdet/apis/inference.py in <module>()
          6 import numpy as np
          7 import torch
    ----> 8 from mmcv.ops import RoIPool
          9 from mmcv.parallel import collate, scatter
         10 from mmcv.runner import load_checkpoint
    

    /usr/local/lib/python3.7/dist-packages/mmcv/ops/__init__.py in <module>()
          1 # Copyright (c) OpenMMLab. All rights reserved.
    ----> 2 from .active_rotated_filter import active_rotated_filter
          3 from .assign_score_withk import assign_score_withk
          4 from .ball_query import ball_query
          5 from .bbox import bbox_overlaps
    

    /usr/local/lib/python3.7/dist-packages/mmcv/ops/active_rotated_filter.py in <module>()
         10 ext_module = ext_loader.load_ext(
         11     '_ext',
    ---> 12     ['active_rotated_filter_forward', 'active_rotated_filter_backward'])
         13 
         14 
    

    /usr/local/lib/python3.7/dist-packages/mmcv/utils/ext_loader.py in load_ext(name, funcs)
         11 
         12     def load_ext(name, funcs):
    ---> 13         ext = importlib.import_module('mmcv.' + name)
         14         for fun in funcs:
         15             assert hasattr(ext, fun), f'{fun} miss in module {name}'
    

    /usr/lib/python3.7/importlib/__init__.py in import_module(name, package)
        125                 break
        126             level += 1
    --> 127     return _bootstrap._gcd_import(name[level:], package, level)
        128 
        129 
    

    ImportError: /usr/local/lib/python3.7/dist-packages/mmcv/_ext.cpython-37m-x86_64-linux-gnu.so: undefined symbol: _ZNK2at10TensorBase8data_ptrIdEEPT_v

    

    ---------------------------------------------------------------------------
    NOTE: If your import is failing due to a missing package, you can
    manually install dependencies using either !pip or !apt.
    
    To view examples of installing some common dependencies, click the
    "Open Examples" button below.
    ---------------------------------------------------------------------------
    


# <b>이미지 준비</b>
이미지를 업로드 해주세요.


```python
#@title <b><font color="black">이미지 업로드</b>

from google.colab import files
import shutil 

def upload_file():
    uploaded = files.upload()
    try:
        fn = list(uploaded.keys())[0]
    except:
        print ("Please upload a valid image file!")
        raise StopExecution
    print('Uploaded file "{name}" of {length} bytes'.format(name=fn,length=len(uploaded[fn])))
    return fn


print ("이미지를 업로드 해 주세요")
fn = upload_file()
shutil.move(fn, "/content/mmdetection/demo/test.jpg")
```

# <b>인물 선택</b>
이미지 내에서 제거할 인물을 선택해주세요.


```python
#@title <b><font color="black">인물 선택</b>

from ipywidgets import Button, HBox, VBox, widgets, Checkbox

img = '/content/mmdetection/demo/test.jpg'
name = img.split("/")[4].split(".")[0]
original = cv2.imread(img)
shape_ori = original.shape

result = inference_detector(model, img)
show_result_pyplot(model, img, result)

original_img = cv2.imread(img)
analysis = np.array(result)
processed_img = original_img.copy()

### 사람찾기

### people 의 신뢰도만 갖는 np array 생성
n = len(analysis[0][0])
list_people = [0 for i in range(n)]

for i in range(len(analysis[0][0])):
  if analysis[0][0][i][4] > 0.3:
    list_people[i] = analysis[0][0][i][4]


shape = original_img.shape
mask_img = np.zeros((shape), dtype = np.uint8)
### range(n), n에 해당하는 만큼의 대상 delete

def gonogo(gonogo_img, people, information):
  cnt = 0
  for i in range(len(people)):


    guy = max(people)
    idx = people.index(guy)
    if guy < 0.2:
      pass
    else:
      xmin,ymin,xmax,ymax = map(round,information[0][0][idx][:4])
      cnt += 1

      target = information[1][0][idx]*1
      (w, h), _ = cv2.getTextSize(
        "person {}".format(int(cnt)), cv2.FONT_HERSHEY_SIMPLEX, 0.6, 1)
      
      blue = (255, 0, 0)
      font =  cv2.FONT_HERSHEY_PLAIN
      if i // 2 == 0:
        y = -10
      else:
        y = 30
      gonogo_img = cv2.putText(gonogo_img, "person {}".format(int(cnt)), (int((xmax+xmin)/2-30), ymin+y), font, 1, (255,255,255), 1, cv2.LINE_AA)
      
      people[idx] = 0
  return gonogo_img, cnt


gonogo_img, p_cnt = gonogo(processed_img, list_people, analysis)
cv2_imshow(gonogo_img)

output = widgets.Output()
print ("")
print ("")
print ("제거할 인물의 인덱스를 선택해주세요")
numbers = [widgets.Checkbox(value=False, description=str(i+1)) for i in range(p_cnt)]
output = widgets.VBox(children=numbers)
display(output)
```

# Mask 생성


```python
#@title <b><font color="black"> instance segmentation</b>


selected_data = []
for i in range(0, len(numbers)):
    if numbers[i].value == True:
        selected_data.append(int([numbers[i].description][0])-1)

name = img.split("/")[4].split(".")[0]
original = cv2.imread(img)
shape_ori = original.shape

### 변수선언
original_img = cv2.imread(img)
analysis = np.array(result)
processed_img = original_img.copy()

### 사람찾기

### people 의 신뢰도만 갖는 np array 생성
n = len(analysis[0][0])
list_people = [0 for i in range(n)]

for i in range(len(analysis[0][0])):
  if analysis[0][0][i][4] > 0.3:
    list_people[i] = analysis[0][0][i][4]


shape = original_img.shape
mask_img = np.zeros((shape), dtype = np.uint8)
### range(n), n에 해당하는 만큼의 대상 delete
cnt = 0
for i in range(len(list_people)):
                        
  
  guy = max(list_people)
  idx = list_people.index(guy)
  if i not in selected_data:
    pass
  else:
    cnt += 1

    target = analysis[1][0][idx]*1
    mask = np.array(target.copy(), dtype = np.uint8) # 0~255로 변환
    mask_reverse = np.array(analysis[1][0][idx]*255, dtype=np.uint8)

    k = cv2.getStructuringElement(cv2.MORPH_RECT, (5,5))

    dst = cv2.dilate(mask_img, k)
    
    ch_b = original_img[:,:,0]
    ch_g = original_img[:,:,1]
    ch_r = original_img[:,:,2]

    filtered_img = cv2.merge((ch_b*mask, ch_g*mask, ch_r*mask)) # target only
    filtered_img2 = cv2.merge((mask*255, mask*255, mask*255))

    filtered_img = cv2.dilate(filtered_img,k)
    filtered_img2 = cv2.dilate(filtered_img2,k)

    processed_img = cv2.addWeighted(processed_img ,1, filtered_img2, 0.5,0)
    
    mask1d_img = mask_img[:,:,0] + mask_reverse
    

    mask_reverse = cv2.merge((mask_reverse,mask_reverse,mask_reverse))
    mask_img = mask_img + mask_reverse

  list_people[idx] = 0
  
mask_img = cv2.dilate(mask_img,k)
mask1d1_img = cv2.dilate(mask1d_img,k)
mask1d2_img = cv2.dilate(mask1d1_img, k, iterations = 10)

cv2.imwrite("/content/result/masked_img.png", processed_img)
cv2.imwrite("/content/result/mask_img.png", mask_img)

cv2.imwrite("/content/result/{}.png".format(name),original_img )

# for LaMa

cv2.imwrite("/content/input_lama/{}_mask01.png".format(name), mask1d1_img)
cv2.imwrite("/content/input_lama/{}_mask02.png".format(name), mask1d2_img)
cv2.imwrite("/content/input_lama/{}.png".format(name),original_img )

print("complete :)")

```


```python
#@title <b><font color="black">object detection</b>

### 변수선언
original_img = cv2.imread(img)
analysis = np.array(result)
processed_img = original_img.copy()
# showme(processed_img)

### 사람찾기

### people 의 신뢰도만 갖는 np array 생성
n = len(analysis[0][0])
list_people = [0 for i in range(n)]

for i in range(len(analysis[0][0])):
  if analysis[0][0][i][4] > 0.5:
    list_people[i] = analysis[0][0][i][4]

shape = original_img.shape
mask_img = np.zeros((shape), dtype = np.uint8)
### range(n), n에 해당하는 만큼의 대상 delete
cnt = 0
for i in range(len(list_people)):
  guy = max(list_people)
  idx = list_people.index(guy)
  if i not in selected_data:
    pass
  else:
    cnt += 1
    ## bounding box procedure
    xmin,ymin,xmax,ymax = map(round,analysis[0][0][idx][:4])
    ymax = int(ymax * float(1.01))
    white = (255,255,255)

    mask_img = cv2.rectangle(mask_img, (xmin, ymin), (xmax, ymax),white,-1 )
    invert_img = np.invert(mask_img)
    if i == 0:
      processed_img = cv2.bitwise_and(original_img, invert_img)
    else:
      processed_img = cv2.bitwise_and(processed_img, invert_img)
    


  list_people[idx] = 0
  


# for mmediting

cv2.imwrite("/content/result/bbox_masked_img.png", processed_img)
cv2.imwrite("/content/result/bbox_mask_img.png", mask_img)

# for LaMa
cv2.imwrite("/content/input_lama/{}.png".format(name), original_img)
cv2.imwrite("/content/input_lama/{}_mask03.png".format(name), mask_img)


print("complete :)")
```

# Inpainting by LaMa


```python
#@title <b><font color="black">Inpainting by LaMa</b>


% cd /content/lama

!export TORCH_HOME=$(pwd) && export PYTHONPATH=$(pwd)

# !python3 bin/predict.py model.path=$(pwd)/big-lama indir=$(pwd)/test_lama outdir= /content/result/result_bbox_inpainting_lama.png
!PYTHONPATH=. TORCH_HOME=$(pwd) python3 bin/predict.py model.path=$(pwd)/big-lama indir=/content/input_lama outdir=/content/result


```

# 결과



```python
#@title <b><font color="black">Inpainting 결과 확인</b>


original = cv2.imread("/content/result/test.png")
result = cv2.imread("/content/result/test_mask02.png")

cv2_imshow(original)
cv2_imshow(result)
```

# Re-inpainting


```python
#@title <b><font color="black">다시 mask 적용 후 inpainting</b>

!mkdir /content/input_lama2
!mkdir /content/result2

!cp -r /content/result/test_mask02.png /content/input_lama2/test_seg.png
!cp -r /content/result/test_mask03.png /content/input_lama2/test_bbox.png

!cp -r /content/input_lama/test_mask02.png /content/input_lama2/test_seg_mask01.png
!cp -r /content/input_lama/test_mask02.png /content/input_lama2/test_bbox_mask01.png

!cp -r /content/input_lama/test_mask03.png /content/input_lama2/test_seg_mask02.png
!cp -r /content/input_lama/test_mask03.png /content/input_lama2/test_bbox_mask02.png

%cd /content/lama
!export TORCH_HOME=$(pwd) && export PYTHONPATH=$(pwd)

# !python3 bin/predict.py model.path=$(pwd)/big-lama indir=$(pwd)/test_lama outdir= /content/result/result_bbox_inpainting_lama.png
!PYTHONPATH=. TORCH_HOME=$(pwd) python3 bin/predict.py model.path=$(pwd)/big-lama indir=/content/input_lama2 outdir=/content/result2

```

# Re-Inpainting 결과 확인


```python
#@title <b><font color="black">Re-inpainting 결과 확인</b>

import time

result = cv2.imread("/content/result/test_mask02.png")
result2 = cv2.imread("/content/result2/test_seg_mask02.png")

cv2_imshow(original)
print("original")
# time.sleep(3)

cv2_imshow(result)
print("Processed once")
# time.sleep(3)

cv2_imshow(result2)
print("Processed Twice")

```
